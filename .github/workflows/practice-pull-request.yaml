name: PR to Develop - CI

on:
  pull_request:
    branches:
      - develop
    paths:
      - 'docker-practice/**'

jobs:
  ci:
    name: CI Pipeline
    uses: ./.github/workflows/shared-jobs.yml
    with:
      target-branch: develop
      skip-on-no-changes: true
      run-docker-compose: false

  merge-ready:
    name: Ready to Merge
    runs-on: ubuntu-latest
    needs: ci
    if: always()
    steps:
      - name: Check pipeline status
        run: |
          echo "üîç Checking CI pipeline status for PR to develop..."
          echo "================================================="

          CI_STATUS="${{ needs.ci.result }}"
          PYTHON_CHANGED="${{ needs.ci.outputs.python-changed }}"
          DOCKER_CHANGED="${{ needs.ci.outputs.docker-changed }}"

          echo "üìä Results:"
          echo "- CI Pipeline: $CI_STATUS"
          echo "- Python Changes: $PYTHON_CHANGED"
          echo "- Docker Changes: $DOCKER_CHANGED"
          echo ""

          if [[ "$CI_STATUS" == "success" ]]; then
            echo "‚úÖ ALL CHECKS PASSED! PR is ready to merge to develop."
            echo "üü¢ Merge button is now ENABLED"
            echo "::notice::Quality gates passed - can merge to develop"
          else
            echo "‚ùå MERGE BLOCKED - CI pipeline failed"
            echo "üî¥ Fix issues before merging"
            echo "::error::Cannot merge to develop - CI checks failed"
            exit 1
          fi
