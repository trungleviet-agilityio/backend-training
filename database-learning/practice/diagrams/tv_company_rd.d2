direction: right

series_domains: {
  shape: sql_table
  id: uuid {constraint: primary_key}
  name: varchar {constraint: unique}
  description: text
  deleted: boolean
  created_time: timestamp
  updated_time: timestamp
}

tv_series: {
  shape: sql_table
  id: uuid {constraint: primary_key}
  domain_id: uuid {constraint: foreign_key}
  title: varchar
  description: text
  start_date: date
  end_date: date
  deleted: boolean
  created_time: timestamp
  updated_time: timestamp
}

episodes: {
  shape: sql_table
  id: uuid {constraint: primary_key}
  series_id: uuid {constraint: foreign_key}
  director_id: uuid {constraint: foreign_key}
  episode_number: int
  title: varchar
  duration_minutes: int
  air_date: date
  deleted: boolean
  created_time: timestamp
  updated_time: timestamp
}

transmissions: {
  shape: sql_table
  id: uuid {constraint: primary_key}
  episode_id: uuid {constraint: foreign_key}
  transmission_time: timestamptz
  viewership: bigint
  deleted: boolean
  created_time: timestamp
  updated_time: timestamp
}

channels: {
  shape: sql_table
  id: uuid {constraint: primary_key}
  name: varchar {constraint: unique}
  type: varchar
  description: text
  deleted: boolean
  created_time: timestamp
  updated_time: timestamp
}

transmission_channels: {
  shape: sql_table
  transmission_id: uuid {constraint: [foreign_key; primary_key]}
  channel_id: uuid {constraint: [foreign_key; primary_key]}
  created_time: timestamp
  updated_time: timestamp
  deleted: boolean
}

employees: {
  shape: sql_table
  id: uuid {constraint: primary_key}
  name: varchar
  email: varchar {constraint: unique}
  birthdate: date
  employment_date: date
  is_internal: boolean
  status: enum
  deleted: boolean
  created_time: timestamp
  updated_time: timestamp
}

roles: {
  shape: sql_table
  id: uuid {constraint: primary_key}
  department_id: uuid {constraint: foreign_key}
  name: varchar {constraint: unique}
  description: text
  deleted: boolean
  created_time: timestamp
  updated_time: timestamp
}

departments: {
  shape: sql_table
  id: uuid {constraint: primary_key}
  name: varchar {constraint: unique}
  description: text
  deleted: boolean
  created_time: timestamp
  updated_time: timestamp
}

employee_roles: {
  shape: sql_table
  employee_id: uuid {constraint: [foreign_key; primary_key]}
  role_id: uuid {constraint: [foreign_key; primary_key]}
  assigned_at: date
  is_active: boolean
  created_time: timestamp
  updated_time: timestamp
}

employee_series_roles: {
  shape: sql_table
  employee_id: uuid {constraint: [foreign_key; primary_key]}
  series_id: uuid {constraint: [foreign_key; primary_key]}
  role_id: uuid {constraint: [foreign_key; primary_key]}
  character_name: varchar
  start_date: date
  end_date: date
  deleted: boolean
  created_time: timestamp
  updated_time: timestamp
}

# Relationships with better styling
series_domains.id -> tv_series.domain_id: {
  label: "1:N"
  style.stroke-width: 2
}

tv_series.id -> episodes.series_id: {
  label: "1:N"
  style.stroke-width: 2
}

episodes.id -> transmissions.episode_id: {
  label: "1:N"
  style.stroke-width: 2
}

employees.id -> episodes.director_id: {
  label: "1:N (director)"
  style.stroke-width: 2
  style: dashed
}

tv_series.id -> employee_series_roles.series_id: {
  label: "1:N"
  style.stroke-width: 2
}

employees.id -> employee_series_roles.employee_id: {
  label: "1:N"
  style.stroke-width: 2
}

roles.id -> employee_series_roles.role_id: {
  label: "1:N"
  style.stroke-width: 2
}

employees.id -> employee_roles.employee_id: {
  label: "1:N"
  style.stroke-width: 2
}

roles.id -> employee_roles.role_id: {
  label: "1:N"
  style.stroke-width: 2
}

roles.department_id -> departments.id: {
  label: "N:1"
  style.stroke-width: 2
}

# New relationships for Channel and TransmissionChannel
transmissions.id -> transmission_channels.transmission_id: {
  label: "1:N"
  style.stroke-width: 2
}

channels.id -> transmission_channels.channel_id: {
  label: "1:N"
  style.stroke-width: 2
}

# Enhanced legend with better styling
legend: {
  style.font-size: 16
  shape: text
  style.fill: "#f7fafc"
  style.stroke: "#2d3748"
  style.stroke-width: 1
  style.border-radius: 8
  style.shadow: true
  label: |md
    ## ðŸŽ¬ Database Relationship Diagram

    ### 1:N Relationships
    - **TVSeries â†’ SeriesDomain**: N:1 â€“ Each series belongs to one domain
    - **TVSeries â†’ Episode**: 1:N â€“ Each series has many episodes
    - **Episode â†’ Transmission**: 1:N â€“ Each episode can have multiple transmissions
    - **Role â†’ Department**: N:1 â€“ Each role belongs to one department
    - **Episode â†’ Director (Employee)**: N:1 â€“ Each episode has one director

    ### M:N Relationships (via linking tables)
    - **TVSeries â†” Employee**: M:N â€“ Through EmployeeSeriesRole (employees participate in series)
    - **Employee â†” Role (company-wide)**: M:N â€“ Through EmployeeRole (employees can have multiple roles)
    - **Transmission â†” Channel**: M:N â€“ Through TransmissionChannel (transmissions can be on multiple channels)
  |
}
